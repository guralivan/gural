#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import streamlit as st
import pandas as pd

st.set_page_config(
    page_title="–¢–µ—Å—Ç WB –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞",
    page_icon="üìä",
    layout="wide"
)

st.title("üìä –¢–µ—Å—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤ Wildberries")

st.write("–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∑–Ω–∞—á–∏—Ç Streamlit —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!")

try:
    # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    if st.button("–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö"):
        with st.spinner("–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ..."):
            df = pd.read_excel('3.xlsx')
            st.success(f"‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ: {df.shape[0]} —Å—Ç—Ä–æ–∫, {df.shape[1]} —Å—Ç–æ–ª–±—Ü–æ–≤")
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏
            st.subheader("–ü–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö:")
            st.dataframe(df.head())
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã
            required_columns = ['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞', '–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞', '–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ', '–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è', '–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏', '–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è']
            missing_columns = [col for col in required_columns if col not in df.columns]
            
            if missing_columns:
                st.error(f"‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å—Ç–æ–ª–±—Ü—ã: {missing_columns}")
            else:
                st.success("‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ç–æ–ª–±—Ü—ã –Ω–∞–π–¥–µ–Ω—ã")
                
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
                st.subheader("–ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:")
                col1, col2, col3, col4 = st.columns(4)
                
                with col1:
                    st.metric("–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ", f"{df['–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ'].sum():,.0f} ‚ÇΩ")
                
                with col2:
                    st.metric("–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è", f"{df['–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è'].sum():,.0f} ‚ÇΩ")
                
                with col3:
                    st.metric("–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏", f"{df['–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏'].sum():,.0f} ‚ÇΩ")
                
                with col4:
                    st.metric("–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è", f"{df['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è'].sum():,.0f} ‚ÇΩ")
                
                # –û–±—â–∞—è —Å—É–º–º–∞
                total = (df['–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ'].sum() + df['–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è'].sum() + 
                        df['–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏'].sum() + df['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è'].sum())
                st.success(f"üí∞ **–û–ë–©–ê–Ø –°–£–ú–ú–ê: {total:,.0f} ‚ÇΩ**")

except Exception as e:
    st.error(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")
    import traceback
    st.code(traceback.format_exc())

st.markdown("---")
st.info("–ï—Å–ª–∏ —ç—Ç–æ—Ç —Ç–µ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ wb_reports_analyzer.py —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")
