#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import random

def generate_2025_data():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ 2025 –≥–æ–¥ –¥–ª—è –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ—Ç—á–µ—Ç–æ–≤"""
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
    try:
        existing_df = pd.read_excel('3.xlsx')
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ: {len(existing_df)} —Å—Ç—Ä–æ–∫")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
        return
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    existing_df['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'] = pd.to_datetime(existing_df['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'], errors='coerce', utc=True)
    existing_df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'] = pd.to_datetime(existing_df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'], errors='coerce', utc=True)
    
    # –£–±–∏—Ä–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    existing_df['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'] = existing_df['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'].dt.tz_localize(None)
    existing_df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'] = existing_df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'].dt.tz_localize(None)
    
    last_date = existing_df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'].max()
    print(f"üìÖ –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞ –≤ –¥–∞–Ω–Ω—ã—Ö: {last_date.strftime('%d.%m.%Y')}")
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å 1 —è–Ω–≤–∞—Ä—è 2025 –ø–æ 31 –¥–µ–∫–∞–±—Ä—è 2025
    start_date = datetime(2025, 1, 1)
    end_date = datetime(2025, 12, 31)
    
    # –°–æ–∑–¥–∞–µ–º –Ω–µ–¥–µ–ª—å–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã
    periods = []
    current_date = start_date
    
    while current_date <= end_date:
        period_end = current_date + timedelta(days=6)
        if period_end > end_date:
            period_end = end_date
        
        periods.append({
            'start': current_date,
            'end': period_end
        })
        
        current_date += timedelta(days=7)
    
    print(f"üìä –°–æ–∑–¥–∞–Ω–æ {len(periods)} –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –∑–∞ 2025 –≥–æ–¥")
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    new_data = []
    report_number = 300000000  # –ù–∞—á–∏–Ω–∞–µ–º —Å –Ω–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞
    
    for i, period in enumerate(periods):
        # –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ –≤–∞—à–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏)
        base_sales = random.uniform(20000, 150000)
        base_logistics = random.uniform(2000, 15000)
        base_storage = random.uniform(100, 2000)
        base_other = random.uniform(500, 5000)
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å (–∑–∏–º–æ–π –º–µ–Ω—å—à–µ –ø—Ä–æ–¥–∞–∂, –ª–µ—Ç–æ–º –±–æ–ª—å—à–µ)
        month = period['start'].month
        if month in [12, 1, 2]:  # –ó–∏–º–∞
            season_multiplier = random.uniform(0.7, 1.0)
        elif month in [6, 7, 8]:  # –õ–µ—Ç–æ
            season_multiplier = random.uniform(1.2, 1.5)
        else:  # –í–µ—Å–Ω–∞/–û—Å–µ–Ω—å
            season_multiplier = random.uniform(0.9, 1.1)
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å—é
        sales = base_sales * season_multiplier
        logistics = base_logistics * season_multiplier
        storage = base_storage * season_multiplier
        other = base_other * season_multiplier
        
        # –ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ (–æ–±—ã—á–Ω–æ –º–µ–Ω—å—à–µ –ø—Ä–æ–¥–∞–∂ –∏–∑-–∑–∞ –∫–æ–º–∏—Å—Å–∏–π)
        total_to_pay = sales * random.uniform(0.6, 0.9)
        
        new_row = {
            '‚Ññ –æ—Ç—á–µ—Ç–∞': report_number + i,
            '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ': '–ì—É—Ä–∞–ª—å –ò–≤–∞–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á –ò–ü',
            '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞': period['start'],
            '–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞': period['end'],
            '–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è': period['end'] + timedelta(days=random.randint(1, 30)),
            '–ü—Ä–æ–¥–∞–∂–∞': round(sales, 2),
            '–í —Ç–æ–º —á–∏—Å–ª–µ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Å–∫–∏–¥–∫–∏ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏': 0,
            '–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞, %': 0,
            '–ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—é –∑–∞ —Ç–æ–≤–∞—Ä': round(sales * 0.95, 2),
            '–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏': round(logistics, 2),
            '–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—É –ø–æ –æ–±–º–µ—Ä–∞–º': 0,
            '–î—Ä—É–≥–∏–µ –≤–∏–¥—ã —à—Ç—Ä–∞—Ñ–æ–≤': 0,
            '–û–±—â–∞—è —Å—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤': 0,
            '–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –í–∞–π–ª–¥–±–µ—Ä—Ä–∏–∑ (–í–í)': 0,
            '–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è': round(storage, 2),
            '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–ª–∞—Ç–Ω–æ–π –ø—Ä–∏–µ–º–∫–∏': 0,
            '–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è': round(other, 2),
            '–°—É–º–º–∞ —É–¥–µ—Ä–∂–∞–Ω–Ω–∞—è –∑–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏': 0,
            '–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ': round(total_to_pay, 2),
            '–í–∞–ª—é—Ç–∞': '—Ä—É–±.',
            '–¢–∏–ø –æ—Ç—á–µ—Ç–∞': '–û—Å–Ω–æ–≤–Ω–æ–π'
        }
        
        new_data.append(new_row)
    
    # –°–æ–∑–¥–∞–µ–º DataFrame —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    new_df = pd.DataFrame(new_data)
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    combined_df = pd.concat([existing_df, new_df], ignore_index=True)
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –Ω–∞—á–∞–ª–∞
    combined_df = combined_df.sort_values('–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞')
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    backup_filename = f"3_backup_{datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx"
    combined_df.to_excel(backup_filename, index=False)
    
    print(f"‚úÖ –°–æ–∑–¥–∞–Ω —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ñ–∞–π–ª: {backup_filename}")
    print(f"üìä –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: {len(combined_df)}")
    print(f"üìÖ –ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö: —Å {combined_df['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'].min().strftime('%d.%m.%Y')} –ø–æ {combined_df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'].max().strftime('%d.%m.%Y')}")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –Ω–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º
    new_data_df = pd.DataFrame(new_data)
    print(f"\nüìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ 2025 –≥–æ–¥:")
    print(f"   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–µ–ª—å: {len(new_data_df)}")
    print(f"   - –û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂: {new_data_df['–ü—Ä–æ–¥–∞–∂–∞'].sum():,.0f} ‚ÇΩ")
    print(f"   - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏: {new_data_df['–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏'].sum():,.0f} ‚ÇΩ")
    print(f"   - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è: {new_data_df['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è'].sum():,.0f} ‚ÇΩ")
    print(f"   - –û–±—â–∏–µ –ø—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è: {new_data_df['–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è'].sum():,.0f} ‚ÇΩ")
    print(f"   - –û–±—â–µ–µ –∏—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: {new_data_df['–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ'].sum():,.0f} ‚ÇΩ")
    
    # –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ö–æ—á–µ—Ç –ª–∏ –æ–Ω –∑–∞–º–µ–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
    print(f"\n‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª {backup_filename}")
    print("–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:")
    print("1. –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ 3.xlsx")
    print("2. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª backup –≤ 3.xlsx")
    print("3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ")
    
    return backup_filename

if __name__ == "__main__":
    generate_2025_data()
