#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import pandas as pd
import sys

def test_data_structure():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ 3.xlsx"""
    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        df = pd.read_excel('3.xlsx')
        
        print("‚úÖ –§–∞–π–ª 3.xlsx —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω")
        print(f"üìä –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: {df.shape[0]} —Å—Ç—Ä–æ–∫, {df.shape[1]} —Å—Ç–æ–ª–±—Ü–æ–≤")
        print("\nüìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã:")
        for i, col in enumerate(df.columns, 1):
            print(f"  {i}. {col}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ç–æ–ª–±—Ü—ã
        required_columns = ['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞', '–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞', '–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏', '–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è', '–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è']
        missing_columns = []
        
        print(f"\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤:")
        for col in required_columns:
            if col in df.columns:
                print(f"  ‚úÖ {col}")
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —á–∏—Å–ª–æ–≤—ã–º —Å—Ç–æ–ª–±—Ü–∞–º
                if col in ['–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏', '–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è', '–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è']:
                    non_null_count = df[col].notna().sum()
                    total_sum = df[col].sum()
                    print(f"     - –ó–∞–ø–æ–ª–Ω–µ–Ω–æ —Å—Ç—Ä–æ–∫: {non_null_count}/{len(df)}")
                    print(f"     - –û–±—â–∞—è —Å—É–º–º–∞: {total_sum:,.0f} ‚ÇΩ")
            else:
                print(f"  ‚ùå {col} - –û–¢–°–£–¢–°–¢–í–£–ï–¢")
                missing_columns.append(col)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—ã
        print(f"\nüìÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç:")
        if '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞' in df.columns and '–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞' in df.columns:
            df['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'] = pd.to_datetime(df['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'], errors='coerce', utc=True)
            df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'] = pd.to_datetime(df['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'], errors='coerce', utc=True)
            
            valid_dates = df[['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞', '–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞']].notna().all(axis=1).sum()
            print(f"  ‚úÖ –°—Ç—Ä–æ–∫ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏: {valid_dates}/{len(df)}")
            
            if valid_dates > 0:
                # –£–±–∏—Ä–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                df_display = df.copy()
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–æ–ª–±—Ü—ã —Å–æ–¥–µ—Ä–∂–∞—Ç datetime –æ–±—ä–µ–∫—Ç—ã
                if pd.api.types.is_datetime64_any_dtype(df_display['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞']):
                    df_display['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'] = df_display['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'].dt.tz_localize(None)
                if pd.api.types.is_datetime64_any_dtype(df_display['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞']):
                    df_display['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'] = df_display['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'].dt.tz_localize(None)
                
                min_date = df_display['–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞'].min()
                max_date = df_display['–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞'].max()
                print(f"  üìÜ –ü–µ—Ä–∏–æ–¥: —Å {min_date.strftime('%d.%m.%Y')} –ø–æ {max_date.strftime('%d.%m.%Y')}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫
        print(f"\nüìã –ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö:")
        print(df.head(3).to_string())
        
        if missing_columns:
            print(f"\n‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å—Ç–æ–ª–±—Ü—ã: {', '.join(missing_columns)}")
            print("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!")
        else:
            print(f"\n‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ç–æ–ª–±—Ü—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç!")
            print("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!")
            
    except FileNotFoundError:
        print("‚ùå –û–®–ò–ë–ö–ê: –§–∞–π–ª 3.xlsx –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ")
        print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ —Å–∫—Ä–∏–ø—Ç")
    except Exception as e:
        print(f"‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: {str(e)}")

if __name__ == "__main__":
    test_data_structure()
