#!/bin/bash

# –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "/Users/ivangural/Downloads/wb_dashboard_streamlit"

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üì¶ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
source venv/bin/activate

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É
stop_port() {
    local port=$1
    if lsof -Pi :$port -sTCP:LISTEN -t >/dev/null ; then
        echo "‚ö†Ô∏è  –ü–æ—Ä—Ç $port —É–∂–µ –∑–∞–Ω—è—Ç. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø—Ä–æ—Ü–µ—Å—Å..."
        lsof -ti:$port | xargs kill -9
        sleep 2
    fi
}

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –≤—Å–µ—Ö –ø–æ—Ä—Ç–∞—Ö
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö..."
stop_port 8501
stop_port 8502
stop_port 8503
stop_port 8504
stop_port 8505
stop_port 8506
stop_port 8507
stop_port 8508
stop_port 8509

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
launch_app() {
    local app_name=$1
    local app_file=$2
    local port=$3
    local url_name=$4
    
    if [ -f "$app_file" ]; then
        echo "üöÄ –ó–∞–ø—É—Å–∫ $app_name –Ω–∞ –ø–æ—Ä—Ç—É $port..."
        nohup streamlit run "$app_file" --server.port $port --server.address localhost > "${app_name}_${port}.log" 2>&1 &
        sleep 3
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å
        if lsof -Pi :$port -sTCP:LISTEN -t >/dev/null ; then
            echo "‚úÖ $app_name —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:$port"
        else
            echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ $app_name –Ω–∞ –ø–æ—Ä—Ç—É $port"
        fi
    else
        echo "‚ö†Ô∏è  –§–∞–π–ª $app_file –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º $app_name"
    fi
}

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üåê –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π..."

# 1. –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (WB Dashboard) –Ω–∞ –ø–æ—Ä—Ç—É 8505
launch_app "WB Dashboard" "dashboard_final.py" 8505 "–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"

# 2. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8506
launch_app "–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞" "production_calendar.py" 8506 "–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞"

# 3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ 45.xlsx –Ω–∞ –ø–æ—Ä—Ç—É 8509
launch_app "–ê–Ω–∞–ª–∏–∑ 45.xlsx" "app_45_simple.py" 8509 "–ê–Ω–∞–ª–∏–∑ 45.xlsx"

# 4. –Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8501
launch_app "–Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞" "UNIT/unit_economics_products_table_FINAL.py" 8501 "–Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞"

# 5. –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ –ø–æ—Ä—Ç—É 8502
launch_app "–ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤" "3/weekly_expenses_analyzer_final_stable.py" 8502 "–ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤"

# 6. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –ø–æ—Ä—Ç—É 8503
launch_app "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤" "order_balance_app.py" 8503 "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤"

# 7. –°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8504
launch_app "–°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" "seasonal_expenses_calculator.py" 8504 "–°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"

echo ""
echo "‚úÖ –í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω—ã!"
echo ""
echo "üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:"
echo "   üéØ WB Dashboard: http://localhost:8505"
echo "   üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞: http://localhost:8506"
echo "   üìä –ê–Ω–∞–ª–∏–∑ 45.xlsx: http://localhost:8509"
echo "   üè™ –Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞: http://localhost:8501"
echo "   üìã –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤: http://localhost:8502"
echo "   üì¶ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤: http://localhost:8503"
echo "   üå°Ô∏è –°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: http://localhost:8504"
echo ""
echo "üí° –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: pkill -f streamlit"
echo "üìã –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª—ã *_port.log"
echo ""

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
wait