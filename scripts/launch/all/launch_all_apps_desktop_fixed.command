#!/bin/bash

# üöÄ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞
# –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –æ—Å–Ω–æ–≤–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
echo "üìÅ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞..."
cd "/Users/ivangural/Downloads/wb_dashboard_streamlit"

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üì¶ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
source venv/bin/activate

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É
stop_port() {
    local port=$1
    if lsof -Pi :$port -sTCP:LISTEN -t >/dev/null ; then
        echo "‚ö†Ô∏è  –ü–æ—Ä—Ç $port —É–∂–µ –∑–∞–Ω—è—Ç. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø—Ä–æ—Ü–µ—Å—Å..."
        lsof -ti:$port | xargs kill -9
        sleep 2
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
launch_app() {
    local app_name="$1"
    local app_path="$2"
    local port="$3"
    local display_name="$4"
    
    echo "üéØ –ó–∞–ø—É—Å–∫: $display_name (–ø–æ—Ä—Ç $port)"
    
    if [ -f "$app_path" ]; then
        echo "üìÅ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω: $app_path"
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        streamlit run "$app_path" --server.port "$port" --server.address localhost &
        local app_pid=$!
        
        # –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        sleep 5
        if lsof -Pi :$port -sTCP:LISTEN -t >/dev/null ; then
            echo "‚úÖ $display_name —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:$port"
            
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            if [ "$port" = "8509" ]; then
                echo "üåê –û—Ç–∫—Ä—ã–≤–∞—é –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –ê–Ω–∞–ª–∏–∑–∞ 45.xlsx..."
                open "http://localhost:$port"
            fi
            
            return 0
        else
            echo "‚ùå –û—à–∏–±–∫–∞: $display_name –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –Ω–∞ –ø–æ—Ä—Ç—É $port"
            return 1
        fi
    else
        echo "‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $app_path"
        return 1
    fi
}

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –≤—Å–µ—Ö –ø–æ—Ä—Ç–∞—Ö
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö..."
stop_port 8501
stop_port 8502
stop_port 8503
stop_port 8504
stop_port 8505
stop_port 8506
stop_port 8509

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö
echo "üåê –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π..."

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ 45.xlsx –Ω–∞ –ø–æ—Ä—Ç—É 8509 (–æ—Å–Ω–æ–≤–Ω–æ–µ)
launch_app "app_45_simple.py" "app_45_simple.py" "8509" "üìä –ê–Ω–∞–ª–∏–∑ 45.xlsx (–æ—Å–Ω–æ–≤–Ω–æ–µ)"
sleep 3

# 1. –Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8501
launch_app "UNIT/unit_economics_products_table_FINAL.py" "UNIT/unit_economics_products_table_FINAL.py" "8501" "üè™ –Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞"
sleep 3

# 2. –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ –ø–æ—Ä—Ç—É 8502
launch_app "3/weekly_expenses_analyzer_final_stable.py" "3/weekly_expenses_analyzer_final_stable.py" "8502" "üìã –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤"
sleep 3

# 3. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –ø–æ—Ä—Ç—É 8503
launch_app "order_balance_app.py" "order_balance_app.py" "8503" "üì¶ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤"
sleep 3

# 4. –°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8504
launch_app "seasonal_expenses_calculator.py" "seasonal_expenses_calculator.py" "8504" "üå°Ô∏è –°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
sleep 3

# 5. –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç—É 8505
launch_app "dashboard_final.py" "dashboard_final.py" "8505" "üéØ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
sleep 3

# 6. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8506
launch_app "production_calendar.py" "production_calendar.py" "8506" "üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞"
sleep 3

echo ""
echo "‚úÖ –í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω—ã!"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω—ã
echo "üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:"
if lsof -Pi :8501 -sTCP:LISTEN -t >/dev/null ; then
    echo "   üè™ –Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞: http://localhost:8501 ‚úÖ"
else
    echo "   üè™ –Æ–Ω–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∞: http://localhost:8501 ‚ùå"
fi

if lsof -Pi :8502 -sTCP:LISTEN -t >/dev/null ; then
    echo "   üìã –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤: http://localhost:8502 ‚úÖ"
else
    echo "   üìã –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–æ–≤: http://localhost:8502 ‚ùå"
fi

if lsof -Pi :8503 -sTCP:LISTEN -t >/dev/null ; then
    echo "   üì¶ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤: http://localhost:8503 ‚úÖ"
else
    echo "   üì¶ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤: http://localhost:8503 ‚ùå"
fi

if lsof -Pi :8504 -sTCP:LISTEN -t >/dev/null ; then
    echo "   üå°Ô∏è –°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: http://localhost:8504 ‚úÖ"
else
    echo "   üå°Ô∏è –°–µ–∑–æ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: http://localhost:8504 ‚ùå"
fi

if lsof -Pi :8505 -sTCP:LISTEN -t >/dev/null ; then
    echo "   üéØ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:8505 ‚úÖ"
else
    echo "   üéØ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:8505 ‚ùå"
fi

if lsof -Pi :8506 -sTCP:LISTEN -t >/dev/null ; then
    echo "   üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞: http://localhost:8506 ‚úÖ"
else
    echo "   üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞: http://localhost:8506 ‚ùå"
fi

if lsof -Pi :8509 -sTCP:LISTEN -t >/dev/null ; then
    echo "   üìä –ê–Ω–∞–ª–∏–∑ 45.xlsx: http://localhost:8509 ‚úÖ (–æ—Å–Ω–æ–≤–Ω–æ–µ)"
else
    echo "   üìä –ê–Ω–∞–ª–∏–∑ 45.xlsx: http://localhost:8509 ‚ùå (–æ—Å–Ω–æ–≤–Ω–æ–µ)"
fi

echo ""
echo "üí° –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: pkill -f streamlit"
echo "üåê –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ê–Ω–∞–ª–∏–∑ 45.xlsx) –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
echo ""

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
wait
