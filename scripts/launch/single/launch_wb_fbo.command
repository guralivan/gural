#!/bin/bash

# –ó–∞–ø—É—Å–∫ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Wildberries FBO Dashboard
# –î–ª—è –º–∞–≥–∞–∑–∏–Ω–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø–æ —Å–∏—Å—Ç–µ–º–µ FBO (Fulfillment by Wildberries)

echo "üöÄ –ó–∞–ø—É—Å–∫ Wildberries FBO Dashboard..."
echo "üìÖ –î–∞—Ç–∞: $(date)"
echo "üè™ –°–∏—Å—Ç–µ–º–∞: FBO (Fulfillment by Wildberries)"
echo "üîß –†–∞–∑–¥–µ–ª—ã: –ó–∞–∫–∞–∑—ã –∏ –ø—Ä–æ–¥–∞–∂–∏, –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –§–∏–Ω–∞–Ω—Å—ã, –û—Å—Ç–∞—Ç–∫–∏, –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ"
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python3 –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Streamlit
if ! python3 -c "import streamlit" &> /dev/null; then
    echo "‚ö†Ô∏è Streamlit –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º..."
    pip3 install streamlit
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
python3 -c "import pandas, requests, plotly" 2>/dev/null || {
    echo "‚ö†Ô∏è –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏..."
    pip3 install pandas requests plotly
}

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–µ—à–∞ FBO
mkdir -p wb_fbo_cache

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç—É 8519
echo "üåê –ó–∞–ø—É—Å–∫ FBO –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç—É 8519..."
echo "üìä –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8519"
echo ""
echo "üîç –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ FBO:"
echo "  ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥–∞–≤—Ü–µ"
echo "  ‚Ä¢ –ó–∞–∫–∞–∑—ã –∏ –ø—Ä–æ–¥–∞–∂–∏ FBO"
echo "  ‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ"
echo "  ‚Ä¢ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
echo "  ‚Ä¢ –û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö WB"
echo "  ‚Ä¢ –î–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–∏"
echo "  ‚Ä¢ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è"
echo ""

# –ó–∞–ø—É—Å–∫ Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
streamlit run apps/wb_api/wb_api_fbo.py --server.port 8519 --server.headless true

echo ""
echo "üëã FBO –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ."


